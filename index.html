<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ã‚¯ãƒ­ãƒƒã‚­ãƒ¼ç·´ç¿’ãƒ“ãƒ¥ãƒ¼ã‚¢</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg:#111; --fg:#eee; --muted:#bdbdbd; --accent:#4aa3ff; --danger:#ff4d6d;
      --panel:#1a1a1a; --ring:#2a2a2a; --radius:16px; --gap:12px; --btn-h:40px;
      --maxw:1200px; --progress-size:84px;
    }
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font:16px/1.6 -apple-system,BlinkMacSystemFont,"Segoe UI","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,system-ui,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .app{min-height:100%; display:grid; grid-template-rows:auto auto 1fr auto}

    header{
      display:flex; gap:var(--gap); align-items:center; justify-content:space-between;
      padding:12px clamp(12px,4vw,24px); border-bottom:1px solid #222;
      background:#0f0f0f; position:sticky; top:0; z-index:10;
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:700}
    .brand svg{width:28px;height:28px}
    .actions{display:flex;gap:var(--gap);flex-wrap:wrap}
    .btn{
      height:var(--btn-h); padding:0 12px; border-radius:10px; border:1px solid #2a2a2a;
      background:#171717; color:var(--fg); display:inline-flex; gap:8px; align-items:center; justify-content:center;
      cursor:pointer; user-select:none;
    }
    .btn:hover{border-color:#333;background:#1c1c1c}
    .btn:focus-visible{outline:2px solid var(--accent); outline-offset:2px}
    .btn.icon{width:var(--btn-h); padding:0}
    .btn.primary{background:var(--accent); border-color:transparent; color:#001a2e}
    .btn.danger{background:#2a1016; border-color:#3a1a22; color:#ff8fa3}
    .btn[disabled]{opacity:.5; pointer-events:none}

    .toolbar{
      display:flex; flex-wrap:wrap; gap:var(--gap);
      padding:12px clamp(12px,4vw,24px); background:#0f0f0f; border-bottom:1px solid #191919;
    }
    .toolbar .group{
      display:flex; gap:var(--gap); align-items:center; padding:8px;
      background:var(--panel); border:1px solid #242424; border-radius:12px;
    }
    label{color:var(--muted); font-size:.9rem}
    input[type="number"], select{
      height:var(--btn-h); padding:0 10px; border-radius:10px; border:1px solid #2a2a2a;
      background:#151515; color:var(--fg);
    }
    input[type="number"]{ width:96px; }
    input[type="range"]{
      width:140px; height:4px; appearance:none; background:#2a2a2a; border-radius:999px; outline:none;
    }
    input[type="range"]::-webkit-slider-thumb{
      appearance:none; width:16px; height:16px; border-radius:50%; background:var(--accent); border:none;
      margin-top:-6px;
    }

    .main{display:grid; place-items:center; padding:clamp(8px,2vw,16px)}
    .stage{
      width:100%; max-width:var(--maxw);
      background:#000;
      border:1px solid #1f1f1f; border-radius:var(--radius);
      position:relative; margin-inline:auto;
      display:grid; place-items:center;
      overflow:hidden;
    }
    .image-wrap{
      display:grid; place-items:center; background:#000;
    }

    /* ç”»åƒï¼šé•·è¾º700pxã¾ã§ç¸®å°ï¼ˆæ‹¡å¤§ãªã—ï¼‰ */
    #art{
      display:block;
      width:auto; height:auto;
      max-width:min(100%, 700px);
      max-height:min(100%, 700px);
      object-fit:contain;
      image-orientation:from-image;
    }

    .overlay{
      position:absolute; inset:0; pointer-events:none;
      display:flex; align-items:flex-start; justify-content:space-between;
      padding:14px;
      background:none;
    }
    .timer{
      width:var(--progress-size); height:var(--progress-size); border-radius:50%;
      background:
        conic-gradient(var(--accent) var(--deg,0deg), var(--ring) 0),
        radial-gradient(circle at 50% 50%, #0f0f0f 62%, transparent 63%);
      display:grid; place-items:center;
      box-shadow:0 0 0 1px #202020, inset 0 0 0 1px #262626;
    }
    .timer span{ font-weight:700; font-feature-settings:"tnum" }
    .stat{
      align-self:flex-end; padding:6px 10px; border-radius:10px; background:rgba(0,0,0,.45);
      border:1px solid #1f1f1f; color:#e8e8e8; font-size:.92rem;
    }

    footer{
      display:flex; gap:var(--gap); align-items:center; justify-content:center;
      padding:14px; color:var(--muted); border-top:1px solid #1a1a1a; background:#0f0f0f;
    }
    .kbd{
      display:inline-block; min-width:1.8ch; padding:.1rem .4rem; border-radius:6px;
      border:1px solid #2a2a2a; background:#161616; color:#ddd; font-size:.92rem;
      box-shadow:inset 0 -2px 0 rgba(255,255,255,.03);
    }
    .hint{opacity:.9}

    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden;
      clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }

    @media (max-width:768px){
      .toolbar{gap:8px}
      .toolbar .group{flex:1; flex-wrap:wrap; justify-content:space-between}
      .actions{gap:8px}
    }
  </style>
</head>
<body>
<div class="app">

  <header id="appHeader">
    <div class="brand" aria-label="ã‚¢ãƒ—ãƒªå">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M3 12a9 9 0 1 0 18 0A9 9 0 0 0 3 12Zm9-7v14M5 9h14M5 15h14"
              stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
      <span>ã‚¯ãƒ­ãƒƒã‚­ãƒ¼ç·´ç¿’ãƒ“ãƒ¥ãƒ¼ã‚¢</span>
    </div>
    <div class="actions" role="group" aria-label="ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ">
      <button id="pickFiles" class="btn" aria-label="ç”»åƒã‚’é¸æŠ">ç”»åƒã‚’é¸æŠ</button>
      <button id="pickFolder" class="btn" aria-label="ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰èª­ã¿è¾¼ã‚€">ãƒ•ã‚©ãƒ«ãƒ€</button>
      <button id="clearList" class="btn danger" aria-label="èª­ã¿è¾¼ã¿ã‚’è§£é™¤">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
  </header>

  <div class="toolbar" id="appToolbar" role="region" aria-label="å†ç”Ÿè¨­å®š">
    <div class="group" role="group" aria-label="å†ç”Ÿæ“ä½œ">
      <button id="togglePlay" class="btn primary" aria-pressed="false" aria-label="å†ç”Ÿ/åœæ­¢">
        <span id="playLabel">å†ç”Ÿ</span>
      </button>
      <button id="prevBtn" class="btn icon" aria-label="å‰ã®ç”»åƒ">â—€</button>
      <button id="nextBtn" class="btn icon" aria-label="æ¬¡ã®ç”»åƒ">â–¶</button>
    </div>

    <div class="group" role="group" aria-label="è¡¨ç¤ºè¨­å®š">
      <label for="interval">ç§’æ•°</label>
      <input id="interval" type="number" inputmode="numeric" min="5" max="600" step="5" value="60" aria-label="åˆ‡æ›¿ç§’æ•°" />
      <button id="shuffleBtn" class="btn" aria-pressed="true" aria-label="ã‚·ãƒ£ãƒƒãƒ•ãƒ«åˆ‡æ›¿">ã‚·ãƒ£ãƒƒãƒ•ãƒ«: ON</button>
      <button id="reshuffleBtn" class="btn" aria-label="é †åºã‚’å†ã‚·ãƒ£ãƒƒãƒ•ãƒ«" title="é †åºã‚’å†ã‚·ãƒ£ãƒƒãƒ•ãƒ«">ğŸ”å†ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
      <button id="fsBtn" class="btn" aria-label="å…¨ç”»é¢">å…¨ç”»é¢</button>
    </div>

    <!-- çµ‚äº†éŸ³ è¨­å®š -->
    <div class="group" role="group" aria-label="çµ‚äº†éŸ³è¨­å®š">
      <button id="pickAudio" class="btn" aria-label="çµ‚äº†éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ">çµ‚äº†éŸ³å£°</button>
      <button id="sfxToggle" class="btn" aria-pressed="true" aria-label="çµ‚äº†éŸ³ã®æœ‰åŠ¹/ç„¡åŠ¹">éŸ³: ON</button>
      <label for="sfxMode">é³´å‹•</label>
      <select id="sfxMode" aria-label="é³´å‹•ã‚¿ã‚¤ãƒŸãƒ³ã‚°">
        <option value="every">æ¯å›</option>
        <option value="last">æœ€å¾Œã®ã¿</option>
      </select>
      <label for="sfxVolume">éŸ³é‡</label>
      <input id="sfxVolume" type="range" min="0" max="1" step="0.05" value="1" />
      <button id="sfxTest" class="btn" aria-label="çµ‚äº†éŸ³ã‚’è©¦è´">è©¦è´</button>
      <span id="sfxName" style="color:var(--muted); font-size:.9rem">æœªé¸æŠ</span>
    </div>
  </div>

  <main class="main">
    <section class="stage" id="stage" aria-live="polite" aria-label="è¡¨ç¤ºã‚¨ãƒªã‚¢">
      <div class="image-wrap" id="imageWrap">
        <img id="art" alt="é¸æŠã—ãŸç”»åƒãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™" />
      </div>
      <div class="overlay">
        <div class="timer" aria-hidden="true"><span id="remain">60</span></div>
        <div class="stat" id="stat">0 / 0 æš</div>
      </div>
      <div id="announce" class="sr-only" aria-live="polite"></div>
    </section>
  </main>

  <footer class="hint" id="appFooter">
    ãƒ›ãƒƒãƒˆã‚­ãƒ¼
    <span class="kbd">Space</span> å†ç”Ÿ/åœæ­¢
    <span class="kbd">â†’</span>/<span class="kbd">â†</span> æ¬¡/å‰
    <span class="kbd">F</span> å…¨ç”»é¢
    <span class="kbd">S</span> ã‚·ãƒ£ãƒƒãƒ•ãƒ«
    <span class="kbd">+</span>/<span class="kbd">âˆ’</span> ç§’æ•°Â±5
    <span class="kbd">R</span> åˆæœŸåŒ–
  </footer>

</div>

<input id="hiddenFile" type="file" accept="image/*" multiple hidden />
<input id="hiddenAudio" type="file" accept="audio/*" hidden />
<script src="app.js" defer></script>
</body>
</html>
