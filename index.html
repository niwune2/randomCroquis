<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ã‚¯ãƒ­ãƒƒã‚­ãƒ¼ç·´ç¿’ãƒ“ãƒ¥ãƒ¼ã‚¢</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg:#111; --fg:#eee; --muted:#bdbdbd; --accent:#4aa3ff; --danger:#ff4d6d;
      --panel:#1a1a1a; --ring:#2a2a2a; --radius:16px; --gap:12px; --btn-h:40px;
      --maxw:1200px;
    }
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font:16px/1.6 -apple-system,BlinkMacSystemFont,"Segoe UI","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,system-ui,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .app{min-height:100%; display:grid; grid-template-rows:auto auto 1fr auto}

    header{
      display:flex; gap:var(--gap); align-items:center; justify-content:space-between;
      padding:12px clamp(12px,4vw,24px); border-bottom:1px solid #222;
      background:#0f0f0f; position:sticky; top:0; z-index:10;
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:700}
    .brand svg{width:28px;height:28px}
    .actions{display:flex;gap:var(--gap);flex-wrap:wrap}
    .btn{
      height:var(--btn-h); padding:0 12px; border-radius:10px; border:1px solid #2a2a2a;
      background:#171717; color:var(--fg); display:inline-flex; gap:8px; align-items:center; justify-content:center;
      cursor:pointer; user-select:none; font-size:.9rem;
    }
    .btn.small{height:32px;padding:0 8px;font-size:.85rem}
    .btn:hover{border-color:#333;background:#1c1c1c}
    .btn:focus-visible{outline:2px solid var(--accent); outline-offset:2px}
    .btn.icon{width:var(--btn-h); padding:0}
    .btn.primary{background:var(--accent); border-color:transparent; color:#001a2e}
    .btn.danger{background:#2a1016; border-color:#3a1a22; color:#ff8fa3}
    .btn[disabled]{opacity:.5; pointer-events:none}

    .toolbar{
      display:flex; flex-wrap:wrap; gap:var(--gap);
      padding:12px clamp(12px,4vw,24px); background:#0f0f0f; border-bottom:1px solid #191919;
    }
    .toolbar .group{
      display:flex; gap:var(--gap); align-items:center; padding:8px;
      background:var(--panel); border:1px solid #242424; border-radius:12px;
    }
    label{color:var(--muted); font-size:.9rem}
    input[type="number"], select{
      height:var(--btn-h); padding:0 10px; border-radius:10px; border:1px solid #2a2a2a;
      background:#151515; color:var(--fg); font-size:.9rem;
    }
    input[type="number"]{ width:96px; }
    input[type="range"]{
      width:120px; height:4px; appearance:none; background:#2a2a2a; border-radius:999px; outline:none;
    }
    input[type="range"]::-webkit-slider-thumb{
      appearance:none; width:16px; height:16px; border-radius:50%; background:var(--accent); border:none;
      margin-top:-6px;
    }

    .main{display:grid; place-items:center; padding:clamp(8px,2vw,16px)}
    .stage{
      width:100%; max-width:var(--maxw);
      background:#000;
      border:1px solid #1f1f1f; border-radius:var(--radius);
      position:relative; margin-inline:auto;
      overflow:hidden;
    }

    /* ä¸Šéƒ¨ï¼šæ™‚é–“ãƒãƒ¼ */
    .timebar{
      padding:8px 10px 4px;
      border-bottom:1px solid #181818;
      display:flex; flex-direction:column; gap:4px;
    }
    .timebar-track{
      position:relative; width:100%; height:8px; border-radius:999px;
      background:#1f1f1f; overflow:hidden;
    }
    .timebar-fill{
      position:absolute; inset:0;
      transform-origin:left center;
      transform:scaleX(0);
      background:linear-gradient(90deg,var(--accent),#9bd0ff);
    }
    .timebar-meta{
      display:flex; justify-content:space-between; align-items:center;
      font-size:.85rem; color:var(--muted);
    }
    .timebar-meta strong{color:#fafafa;font-feature-settings:"tnum"}

    .image-wrap{
      padding:10px; box-sizing:border-box;
      display:grid; place-items:center; background:#000;
    }

    /* ç”»åƒï¼šé•·è¾º700pxã¾ã§ã€ã‹ã¤ç”»é¢ã®70vhã¾ã§ã«åˆ¶é™ã—ã¦ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æ¸›ã‚‰ã™ */
    #art{
      display:block;
      width:auto; height:auto;
      max-width:min(100%, 700px);
      max-height:min(700px, 70vh);
      object-fit:contain;
      image-orientation:from-image;
    }

    .overlay{
      position:absolute; inset:auto 10px 10px auto; pointer-events:none;
      display:flex; flex-direction:column; align-items:flex-end; gap:6px;
    }
    .stat{
      padding:4px 8px; border-radius:8px; background:rgba(0,0,0,.6);
      border:1px solid #262626; color:#e8e8e8; font-size:.9rem;
      font-feature-settings:"tnum";
    }

    .note{
      padding:6px 10px 10px;
      font-size:.8rem; color:var(--muted);
    }

    footer{
      display:flex; gap:var(--gap); align-items:center; justify-content:center;
      padding:14px; color:var(--muted); border-top:1px solid #1a1a1a; background:#0f0f0f;
      flex-wrap:wrap;
    }
    .kbd{
      display:inline-block; min-width:1.8ch; padding:.1rem .4rem; border-radius:6px;
      border:1px solid #2a2a2a; background:#161616; color:#ddd; font-size:.92rem;
      box-shadow:inset 0 -2px 0 rgba(255,255,255,.03);
    }
    .hint{opacity:.9}

    /* çµ‚äº†éŸ³è¨­å®šãƒ‘ãƒãƒ« */
    .sfx-panel{
      display:none;
      flex-wrap:wrap; gap:8px; align-items:center;
      margin-left:4px;
    }
    .sfx-panel.open{display:flex;}

    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden;
      clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }

    @media (max-width:768px){
      header{flex-direction:column; align-items:stretch}
      .toolbar{gap:8px}
      .toolbar .group{flex:1; flex-wrap:wrap; justify-content:space-between}
      .actions{gap:8px}
    }
  </style>
</head>
<body>
<div class="app">

  <header id="appHeader">
    <div class="brand" aria-label="ã‚¢ãƒ—ãƒªå">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M3 12a9 9 0 1 0 18 0A9 9 0 0 0 3 12Zm9-7v14M5 9h14M5 15h14"
              stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
      <span>ã‚¯ãƒ­ãƒƒã‚­ãƒ¼ç·´ç¿’ãƒ“ãƒ¥ãƒ¼ã‚¢</span>
    </div>
    <div class="actions" role="group" aria-label="ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ">
      <button id="pickFiles" class="btn" aria-label="ç”»åƒã‚’é¸æŠ">ç”»åƒã‚’é¸æŠ</button>
      <button id="pickFolder" class="btn" aria-label="ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰èª­ã¿è¾¼ã‚€">ãƒ•ã‚©ãƒ«ãƒ€</button>
      <button id="clearList" class="btn danger" aria-label="èª­ã¿è¾¼ã¿ã‚’è§£é™¤">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
  </header>

  <div class="toolbar" id="appToolbar" role="region" aria-label="å†ç”Ÿè¨­å®š">
    <div class="group" role="group" aria-label="å†ç”Ÿæ“ä½œ">
      <button id="togglePlay" class="btn primary" aria-pressed="false" aria-label="å†ç”Ÿ/åœæ­¢">
        <span id="playLabel">å†ç”Ÿ</span>
      </button>
      <button id="prevBtn" class="btn icon" aria-label="å‰ã®ç”»åƒ">â—€</button>
      <button id="nextBtn" class="btn icon" aria-label="æ¬¡ã®ç”»åƒ">â–¶</button>
    </div>

    <div class="group" role="group" aria-label="è¡¨ç¤ºãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®š">
      <label for="interval">ç§’æ•°</label>
      <input id="interval" type="number" inputmode="numeric" min="5" max="600" step="5" value="60" aria-label="åˆ‡æ›¿ç§’æ•°" />
      <label for="targetCount">æšæ•°</label>
      <input id="targetCount" type="number" inputmode="numeric" min="0" step="1" value="0" aria-label="ç›®æ¨™æšæ•°ï¼ˆ0ã§ç„¡åˆ¶é™ï¼‰" />
      <button id="shuffleBtn" class="btn" aria-pressed="true" aria-label="ã‚·ãƒ£ãƒƒãƒ•ãƒ«åˆ‡æ›¿">ã‚·ãƒ£ãƒƒãƒ•ãƒ«: ON</button>
      <button id="reshuffleBtn" class="btn" aria-label="é †åºã‚’å†ã‚·ãƒ£ãƒƒãƒ•ãƒ«" title="é †åºã‚’å†ã‚·ãƒ£ãƒƒãƒ•ãƒ«">ğŸ”å†ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
      <button id="fsBtn" class="btn" aria-label="å…¨ç”»é¢">å…¨ç”»é¢</button>
    </div>

    <div class="group" role="group" aria-label="çµ‚äº†éŸ³ãƒ»çµ‚äº†ç”»åƒè¨­å®š">
      <button id="finishImageBtn" class="btn small" aria-label="çµ‚äº†ç”¨ç”»åƒã‚’é¸æŠ">çµ‚äº†ç”»åƒ</button>
      <span id="finishImageName" style="font-size:.8rem;color:var(--muted);max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">æœªé¸æŠ</span>
      <button id="sfxPanelToggle" class="btn small" aria-expanded="false" aria-controls="sfxPanel">çµ‚äº†éŸ³è¨­å®š â–¾</button>
      <div id="sfxPanel" class="sfx-panel">
        <button id="pickAudio" class="btn small" aria-label="çµ‚äº†éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ">çµ‚äº†éŸ³å£°</button>
        <button id="sfxToggle" class="btn small" aria-pressed="true" aria-label="çµ‚äº†éŸ³ã®æœ‰åŠ¹/ç„¡åŠ¹">éŸ³: ON</button>
        <label for="sfxMode">é³´å‹•</label>
        <select id="sfxMode" aria-label="é³´å‹•ã‚¿ã‚¤ãƒŸãƒ³ã‚°">
          <option value="every">æ¯å›</option>
          <option value="last">æœ€å¾Œã®ã¿</option>
        </select>
        <label for="sfxVolume">éŸ³é‡</label>
        <input id="sfxVolume" type="range" min="0" max="1" step="0.05" value="1" />
        <button id="sfxTest" class="btn small" aria-label="çµ‚äº†éŸ³ã‚’è©¦è´">è©¦è´</button>
        <span id="sfxName" style="color:var(--muted); font-size:.8rem;max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">æœªé¸æŠ</span>
      </div>
    </div>
  </div>

  <main class="main">
    <section class="stage" id="stage" aria-live="polite" aria-label="è¡¨ç¤ºã‚¨ãƒªã‚¢">
      <div class="timebar">
        <div class="timebar-track">
          <div class="timebar-fill" id="timeFill"></div>
        </div>
        <div class="timebar-meta">
          <span id="timeText"><strong>60</strong> ç§’</span>
          <span id="sessionText">æšæ•°: ç„¡åˆ¶é™</span>
        </div>
      </div>

      <div class="image-wrap" id="imageWrap">
        <img id="art" alt="é¸æŠã—ãŸç”»åƒãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™" />
      </div>

      <div class="overlay">
        <div class="stat" id="stat">0 / 0 æš</div>
      </div>

      <div id="announce" class="sr-only" aria-live="polite"></div>
    </section>
  </main>

  <div class="note">
    â€» ç¸¦é•·ã™ãã‚‹ç”»åƒï¼ˆã‚¹ãƒãƒ›å£ç´™ãªã©ï¼‰ã¯ç”»é¢å†…ã§ç´°ãè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>
    &emsp;ã‚¯ãƒ­ãƒƒã‚­ãƒ¼ç”¨é€”ã§ã¯æ¨ªé•·ã€œæ­£æ–¹å½¢ï¼ˆä¾‹: 4:3ã€œ16:9ï¼‰ç¨‹åº¦ã®æ¯”ç‡ã‚’æ¨å¥¨ã—ã¾ã™ã€‚
  </div>

  <footer class="hint" id="appFooter">
    ãƒ›ãƒƒãƒˆã‚­ãƒ¼ï¼š
    <span class="kbd">Space</span> å†ç”Ÿ/åœæ­¢
    <span class="kbd">â†’</span>/<span class="kbd">â†</span> æ¬¡/å‰
    <span class="kbd">F</span> å…¨ç”»é¢
    <span class="kbd">S</span> ã‚·ãƒ£ãƒƒãƒ•ãƒ«
    <span class="kbd">+</span>/<span class="kbd">âˆ’</span> ç§’æ•°Â±5
    <span class="kbd">R</span> åˆæœŸåŒ–
  </footer>

</div>

<!-- ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ› -->
<input id="hiddenFile" type="file" accept="image/*" multiple hidden />
<input id="hiddenAudio" type="file" accept="audio/*" hidden />
<input id="finishImageFile" type="file" accept="image/*" hidden />

<script src="app.js" defer></script>
</body>
</html>
