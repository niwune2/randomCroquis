<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ã‚¯ãƒ­ãƒƒã‚­ãƒ¼ç·´ç¿’ãƒ“ãƒ¥ãƒ¼ã‚¢ï¼ˆ1æš/2æšï¼‰</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg:#111; --fg:#eee; --muted:#bdbdbd; --accent:#4aa3ff; --danger:#ff4d6d;
      --panel:#1a1a1a; --radius:16px; --gap:12px; --btn-h:40px; --maxw:1200px;
      --img-max-h: 70vh; /* JSã§ä¸Šæ›¸ã */
    }
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font:16px/1.6 -apple-system,BlinkMacSystemFont,"Segoe UI","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,system-ui,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .app{min-height:100%; display:grid; grid-template-rows:auto auto 1fr auto}

    header{
      padding:12px clamp(12px,4vw,24px);
      border-bottom:1px solid #222;
      background:#0f0f0f;
      position:sticky; top:0; z-index:10;
      display:flex; flex-direction:column; gap:6px;
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:800}
    .brand svg{width:28px;height:28px}
    .purpose{
      color:var(--muted);
      font-size:.92rem;
    }

    .toolbar{
      display:flex; flex-wrap:wrap; gap:var(--gap);
      padding:12px clamp(12px,4vw,24px);
      background:#0f0f0f; border-bottom:1px solid #191919;
      position:sticky; top:76px; z-index:9;
    }
    .group{
      display:flex; gap:var(--gap); align-items:center; padding:8px;
      background:var(--panel); border:1px solid #242424; border-radius:12px;
      flex-wrap:wrap;
    }

    .btn{
      height:var(--btn-h); padding:0 12px; border-radius:10px; border:1px solid #2a2a2a;
      background:#171717; color:var(--fg);
      display:inline-flex; gap:8px; align-items:center; justify-content:center;
      cursor:pointer; user-select:none; font-size:.9rem;
    }
    .btn:hover{border-color:#333;background:#1c1c1c}
    .btn:focus-visible{outline:2px solid var(--accent); outline-offset:2px}
    .btn[disabled]{opacity:.5; pointer-events:none}
    .btn.icon{width:var(--btn-h); padding:0}
    .btn.primary{background:var(--accent); border-color:transparent; color:#001a2e}
    .btn.small{height:32px;padding:0 8px;font-size:.85rem}

    /* ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼‰ */
    .seg{
      display:inline-flex; border:1px solid #2a2a2a; border-radius:12px; overflow:hidden;
    }
    .seg button{
      height:32px; padding:0 12px; border:0; background:#151515; color:var(--muted);
      cursor:pointer; font-size:.9rem;
    }
    .seg button[aria-pressed="true"]{
      background:var(--accent); color:#001a2e; font-weight:700;
    }

    label{color:var(--muted); font-size:.9rem}
    input[type="number"], select{
      height:var(--btn-h); padding:0 10px; border-radius:10px; border:1px solid #2a2a2a;
      background:#151515; color:var(--fg); font-size:.9rem;
    }
    input[type="number"]{ width:96px; }
    input[type="range"]{
      width:120px; height:4px; appearance:none; background:#2a2a2a; border-radius:999px; outline:none;
    }
    input[type="range"]::-webkit-slider-thumb{
      appearance:none; width:16px; height:16px; border-radius:50%; background:var(--accent); border:none;
      margin-top:-6px;
    }

    .main{display:grid; place-items:center; padding:clamp(8px,2vw,16px)}
    .stage{
      width:100%; max-width:var(--maxw);
      background:#000;
      border:1px solid #1f1f1f; border-radius:var(--radius);
      position:relative; margin-inline:auto;
      overflow:hidden;
    }

    /* ä¸Šéƒ¨ï¼šæ™‚é–“ãƒãƒ¼ */
    .timebar{
      padding:8px 10px 4px;
      border-bottom:1px solid #181818;
      display:flex; flex-direction:column; gap:4px;
    }
    .timebar-track{
      position:relative; width:100%; height:8px; border-radius:999px;
      background:#1f1f1f; overflow:hidden;
    }
    .timebar-fill{
      position:absolute; inset:0;
      transform-origin:left center;
      transform:scaleX(0);
      background:linear-gradient(90deg,var(--accent),#9bd0ff);
    }
    .timebar-meta{
      display:flex; justify-content:space-between; align-items:center;
      font-size:.85rem; color:var(--muted);
    }
    .timebar-meta strong{color:#fafafa;font-feature-settings:"tnum"}

    /* ãƒ“ãƒ¥ãƒ¼åˆ‡æ›¿ */
    .views{position:relative}
    .view{display:none}
    .view.active{display:block}

    /* 1æšãƒ“ãƒ¥ãƒ¼ */
    .single-wrap{
      padding:10px; box-sizing:border-box;
      display:grid; place-items:center; background:#000;
    }
    #singleImg{
      display:block;
      width:auto; height:auto;
      max-width:min(100%, 700px);
      max-height:min(700px, var(--img-max-h));
      object-fit:contain;
      image-orientation:from-image;
    }
    .single-stat{
      position:absolute; right:10px; bottom:10px;
      padding:4px 8px; border-radius:8px; background:rgba(0,0,0,.6);
      border:1px solid #262626; color:#e8e8e8; font-size:.9rem;
      font-feature-settings:"tnum";
      pointer-events:none;
    }

    /* 2æšãƒ“ãƒ¥ãƒ¼ */
    .dual-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
      padding:10px;
      box-sizing:border-box;
      background:#000;
    }
    .pane{
      border:1px solid #1f1f1f;
      border-radius:14px;
      overflow:hidden;
      background:#050505;
      display:grid;
      grid-template-rows:auto 1fr auto;
      min-width:0;
    }
    .pane-head{
      display:flex; justify-content:space-between; align-items:center;
      padding:8px 10px;
      border-bottom:1px solid #141414;
      color:var(--muted);
      font-size:.9rem;
    }
    .pane-head strong{color:#fafafa}
    .pane-body{
      display:grid; place-items:center;
      padding:8px;
      min-height:0;
    }
    .pane img{
      display:block;
      width:auto; height:auto;
      max-width:100%;
      max-height:min(700px, var(--img-max-h));
      object-fit:contain;
      image-orientation:from-image;
    }
    .placeholder{
      color:#777; font-size:.95rem;
      border:1px dashed #2a2a2a;
      border-radius:12px;
      padding:18px 14px;
      text-align:center;
      max-width:90%;
    }
    .pane-foot{
      padding:6px 10px;
      border-top:1px solid #141414;
      color:#8c8c8c;
      font-size:.78rem;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    /* 3ç§’ã‚«ã‚¦ãƒ³ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    .count-overlay{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,.60);
      display:none;
      align-items:center;
      justify-content:center;
      pointer-events:none;
      z-index:3;
    }
    .count-overlay.active{display:flex}
    .count-number{
      font-size:clamp(48px, 10vw, 96px);
      font-weight:800;
      color:#fff;
      text-shadow:0 0 20px rgba(0,0,0,.8);
      font-feature-settings:"tnum";
    }

    /* çµ‚äº†ç”»é¢ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆ1æš/2æšå…±é€šï¼‰ */
    .finish-overlay{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,.85);
      display:none;
      z-index:4;
      padding:14px;
      box-sizing:border-box;
    }
    .finish-overlay.active{display:grid; place-items:center}
    .finish-card{
      width:min(900px, 95%);
      border:1px solid #2a2a2a;
      border-radius:16px;
      background:#0a0a0a;
      padding:14px;
      display:grid;
      gap:10px;
      justify-items:center;
    }
    #finishImg{
      display:block;
      width:auto; height:auto;
      max-width:min(100%, 700px);
      max-height:min(700px, var(--img-max-h));
      object-fit:contain;
    }
    .finish-text{
      color:#dcdcdc;
      font-size:1.05rem;
      text-align:center;
    }
    .finish-sub{
      color:#9a9a9a;
      font-size:.85rem;
      text-align:center;
    }

    /* çµ‚äº†éŸ³è¨­å®šãƒ‘ãƒãƒ« */
    .sfx-panel{display:none; flex-wrap:wrap; gap:8px; align-items:center; margin-left:4px;}
    .sfx-panel.open{display:flex}

    .note{
      padding:6px clamp(12px,4vw,24px) 10px;
      font-size:.8rem; color:var(--muted);
    }

    footer{
      display:flex; gap:var(--gap); align-items:center; justify-content:center;
      padding:14px; color:var(--muted); border-top:1px solid #1a1a1a; background:#0f0f0f;
      flex-wrap:wrap;
    }
    .kbd{
      display:inline-block; min-width:1.8ch; padding:.1rem .4rem; border-radius:6px;
      border:1px solid #2a2a2a; background:#161616; color:#ddd; font-size:.92rem;
      box-shadow:inset 0 -2px 0 rgba(255,255,255,.03);
    }

    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden;
      clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }

    @media (max-width:900px){
      .dual-grid{grid-template-columns:1fr}
      .toolbar{top:92px}
    }
  </style>
</head>
<body>
<div class="app">

  <header>
    <div class="brand">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M3 12a9 9 0 1 0 18 0A9 9 0 0 0 3 12Zm9-7v14M5 9h14M5 15h14"
              stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
      <span>ã‚¯ãƒ­ãƒƒã‚­ãƒ¼ç·´ç¿’ãƒ“ãƒ¥ãƒ¼ã‚¢ï¼ˆ1æš / 2æšï¼‰</span>
    </div>
    <div class="purpose">
      ç›®çš„ï¼šã‚¯ãƒ­ãƒƒã‚­ãƒ¼ã‚’é€šã—ã¦ <b>ã‚¤ãƒ©ã‚¹ãƒˆã®å¿œç”¨åŠ›ï¼ˆç½®ãæ›ãˆãƒ»å·®ã—æ›¿ãˆãƒ»ã‚¢ãƒ¬ãƒ³ã‚¸ï¼‰</b> ã‚’ä¼¸ã°ã™ãŸã‚ã®ãƒ“ãƒ¥ãƒ¼ã‚¢ã§ã™ã€‚
    </div>
  </header>

  <div class="toolbar" role="region" aria-label="æ“ä½œãƒãƒ¼">

    <!-- ãƒ¢ãƒ¼ãƒ‰ -->
    <div class="group" role="group" aria-label="ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿">
      <span style="color:var(--muted);font-size:.9rem;">ãƒ¢ãƒ¼ãƒ‰</span>
      <div class="seg" role="group" aria-label="1æš/2æš">
        <button id="modeSingle" aria-pressed="true" type="button">1æš</button>
        <button id="modeDual" aria-pressed="false" type="button">2æš</button>
      </div>
    </div>

    <!-- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š1æš -->
    <div class="group" id="fileSingle" role="group" aria-label="ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œï¼ˆ1æšï¼‰">
      <button id="pickSingleFiles" class="btn" type="button">ç”»åƒã‚’é¸æŠ</button>
      <button id="pickSingleFolder" class="btn" type="button">ãƒ•ã‚©ãƒ«ãƒ€</button>
      <button id="clearSingle" class="btn" type="button" style="background:#2a1016;border-color:#3a1a22;color:#ff8fa3;">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <!-- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š2æš -->
    <div class="group" id="fileDual" role="group" aria-label="ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œï¼ˆ2æšï¼‰" style="display:none;">
      <span style="color:var(--muted);font-size:.9rem;">å·¦</span>
      <button id="pickLeftFiles" class="btn" type="button">ç”»åƒ</button>
      <button id="pickLeftFolder" class="btn" type="button">ãƒ•ã‚©ãƒ«ãƒ€</button>
      <button id="clearLeft" class="btn" type="button" style="background:#2a1016;border-color:#3a1a22;color:#ff8fa3;">ãƒªã‚»ãƒƒãƒˆ</button>

      <span style="color:var(--muted);font-size:.9rem; margin-left:6px;">å³</span>
      <button id="pickRightFiles" class="btn" type="button">ç”»åƒ</button>
      <button id="pickRightFolder" class="btn" type="button">ãƒ•ã‚©ãƒ«ãƒ€</button>
      <button id="clearRight" class="btn" type="button" style="background:#2a1016;border-color:#3a1a22;color:#ff8fa3;">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <!-- å†ç”Ÿæ“ä½œ -->
    <div class="group" role="group" aria-label="å†ç”Ÿæ“ä½œ">
      <button id="togglePlay" class="btn primary" aria-pressed="false" type="button">
        <span id="playLabel">å†ç”Ÿ</span>
      </button>
      <button id="prevBtn" class="btn icon" type="button" aria-label="å‰">â—€</button>
      <button id="nextBtn" class="btn icon" type="button" aria-label="æ¬¡">â–¶</button>
    </div>

    <!-- è¨­å®š -->
    <div class="group" role="group" aria-label="è¨­å®š">
      <label for="interval">ç§’æ•°</label>
      <input id="interval" type="number" inputmode="numeric" min="5" max="600" step="5" value="60" />
      <label for="targetCount">æšæ•°</label>
      <input id="targetCount" type="number" inputmode="numeric" min="0" step="1" value="0" aria-label="ç›®æ¨™æšæ•°ï¼ˆ0ã§ç„¡åˆ¶é™ï¼‰" />
      <button id="shuffleBtn" class="btn" aria-pressed="true" type="button">ã‚·ãƒ£ãƒƒãƒ•ãƒ«: ON</button>
      <button id="reshuffleBtn" class="btn" type="button">ğŸ”å†ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
      <button id="fsBtn" class="btn" type="button">å…¨ç”»é¢</button>
    </div>

    <!-- çµ‚äº†ç”»åƒãƒ»éŸ³ -->
    <div class="group" role="group" aria-label="çµ‚äº†è¨­å®š">
      <button id="finishImageBtn" class="btn small" type="button">çµ‚äº†ç”»åƒ</button>
      <span id="finishImageName" style="font-size:.8rem;color:var(--muted);max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">æœªé¸æŠ</span>

      <button id="sfxPanelToggle" class="btn small" aria-expanded="false" aria-controls="sfxPanel" type="button">çµ‚äº†éŸ³è¨­å®š â–¾</button>
      <div id="sfxPanel" class="sfx-panel">
        <button id="pickAudio" class="btn small" type="button">çµ‚äº†éŸ³å£°</button>
        <button id="sfxToggle" class="btn small" aria-pressed="true" type="button">éŸ³: ON</button>
        <label for="sfxMode">é³´å‹•</label>
        <select id="sfxMode">
          <option value="every">æ¯å›</option>
          <option value="last">æœ€å¾Œã®ã¿</option>
        </select>
        <label for="sfxVolume">éŸ³é‡</label>
        <input id="sfxVolume" type="range" min="0" max="1" step="0.05" value="1" />
        <button id="sfxTest" class="btn small" type="button">è©¦è´</button>
        <span id="sfxName" style="color:var(--muted); font-size:.8rem;max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">æœªé¸æŠ</span>
      </div>
    </div>
  </div>

  <main class="main">
    <section class="stage" id="stage" aria-label="è¡¨ç¤ºã‚¨ãƒªã‚¢">
      <div class="timebar">
        <div class="timebar-track">
          <div class="timebar-fill" id="timeFill"></div>
        </div>
        <div class="timebar-meta">
          <span id="timeText"><strong>60</strong> ç§’</span>
          <span id="sessionText">æšæ•°: ç„¡åˆ¶é™</span>
        </div>
      </div>

      <div class="views">
        <!-- 1æš -->
        <div id="viewSingle" class="view active" aria-label="1æšè¡¨ç¤º">
          <div class="single-wrap">
            <img id="singleImg" alt="ç”»åƒæœªé¸æŠ" />
          </div>
          <div class="single-stat" id="singleStat">0 / 0 æš</div>
        </div>

        <!-- 2æš -->
        <div id="viewDual" class="view" aria-label="2æšè¡¨ç¤º">
          <div class="dual-grid">
            <div class="pane">
              <div class="pane-head">
                <span>å·¦</span>
                <span id="leftStat"><strong>0</strong> / 0</span>
              </div>
              <div class="pane-body">
                <div id="leftPlaceholder" class="placeholder">å·¦ç”»åƒãŒæœªé¸æŠã§ã™</div>
                <img id="leftImg" alt="å·¦ç”»åƒ" hidden />
              </div>
              <div class="pane-foot" id="leftName">â€”</div>
            </div>

            <div class="pane">
              <div class="pane-head">
                <span>å³</span>
                <span id="rightStat"><strong>0</strong> / 0</span>
              </div>
              <div class="pane-body">
                <div id="rightPlaceholder" class="placeholder">å³ç”»åƒãŒæœªé¸æŠã§ã™</div>
                <img id="rightImg" alt="å³ç”»åƒ" hidden />
              </div>
              <div class="pane-foot" id="rightName">â€”</div>
            </div>
          </div>
        </div>
      </div>

      <!-- 3ç§’ã‚«ã‚¦ãƒ³ãƒˆ -->
      <div id="countOverlay" class="count-overlay" aria-hidden="true">
        <div id="countNumber" class="count-number">3</div>
      </div>

      <!-- çµ‚äº†ç”»é¢ -->
      <div id="finishOverlay" class="finish-overlay" aria-hidden="true">
        <div class="finish-card">
          <img id="finishImg" alt="çµ‚äº†ç”»åƒ" hidden />
          <div class="finish-text" id="finishText">ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†</div>
          <div class="finish-sub">ï¼ˆå†ç”Ÿã§æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã§ãã¾ã™ï¼‰</div>
        </div>
      </div>

      <div id="announce" class="sr-only" aria-live="polite"></div>
    </section>
  </main>

  <div class="note" id="note">
    â€» ç¸¦é•·ã™ãã‚‹ç”»åƒï¼ˆã‚¹ãƒãƒ›å£ç´™ãªã©ï¼‰ã¯ç”»é¢å†…ã§ç´°ãè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã‚¯ãƒ­ãƒƒã‚­ãƒ¼ç”¨é€”ã§ã¯æ¨ªé•·ã€œæ­£æ–¹å½¢ï¼ˆä¾‹: 4:3ã€œ16:9ï¼‰ç¨‹åº¦ã‚’æ¨å¥¨ã—ã¾ã™ã€‚
  </div>

  <footer id="footer">
    ãƒ›ãƒƒãƒˆã‚­ãƒ¼ï¼š
    <span class="kbd">Space</span> å†ç”Ÿ/åœæ­¢
    <span class="kbd">â†’</span>/<span class="kbd">â†</span> æ¬¡/å‰
    <span class="kbd">F</span> å…¨ç”»é¢
    <span class="kbd">S</span> ã‚·ãƒ£ãƒƒãƒ•ãƒ«
    <span class="kbd">+</span>/<span class="kbd">âˆ’</span> ç§’æ•°Â±5
    <span class="kbd">R</span> åˆæœŸåŒ–
  </footer>

</div>

<!-- hidden inputs -->
<input id="singleFiles" type="file" accept="image/*" multiple hidden />
<input id="leftFiles" type="file" accept="image/*" multiple hidden />
<input id="rightFiles" type="file" accept="image/*" multiple hidden />

<input id="audioFile" type="file" accept="audio/*" hidden />
<input id="finishImageFile" type="file" accept="image/*" hidden />

<script src="app.js" defer></script>
</body>
</html>
